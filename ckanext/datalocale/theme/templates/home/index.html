<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >

  <py:def function="body_class">${h.literal('no-sidebar')}</py:def>
 
  <py:def function="page_title">Welcome to ${g.site_title}</py:def>

  <div py:match="//div[@id='content']" class="front-page">
  <div role="main" class="hero">
	<div id="content" class="container">
		<div class="flash-messages"></div>
	
	<!-- ligne bootstrap -->
	<div class="row">
	
	  <!-- bloc bienvenue -->
	  <section class="span4 module-narrow module-shallow">
		<header class="circle-green">
			<div class="media-content">
			  <h3 class="media-heading">Doc</h3>
			  <ul class="unstyled circle-padding">
				<li>${h.link_to(_('About'), h.url_for(controller='home', action='about'))}</li>
				<li py:if="not c.user"><a href="${c.site_url}${h.url_for('/user/new')}">Créer un compte</a></li>
				<li py:if="c.user" class="add_diffuseur"></li>
				<!--<li><a  href="${c.site_url}${h.url_for('/diffuseur')}">Créer un producteur</a></lii>--> 
				<li><a  href="${c.site_url}${h.url_for('/dataset/new')}">Déposer un jeu de données</a></li>
			  </ul>
			</div>
		</header>
	  </section>
<?python
c.diffuseurNum = 0
c.producteurNum = 0
for c.gp in c.groups:
 if c.gp["type"] == "organization":
  c.diffuseurNum = c.diffuseurNum + 1
 elif c.gp["type"] == "service":
  c.producteurNum = c.producteurNum + 1
?>
  
	  <!-- bloc groupes -->
	  <section class="span4 module-narrow module-shallow">
		<header class="circle-red">
			<div class="media-content">
			  <h3 class="media-heading">Ressources</h3>
			  <ul class="unstyled circle-padding">
				<li ><a href="${c.site_url}${h.url_for('/user')}"><span id="userNumSpan">145</span> utilisateurs</a> disponibles</li>
				<li><a href="${c.site_url}${h.url_for('/diffuseur')}">${c.producteurNum} producteurs rattachés <br/>à ${c.diffuseurNum} diffuseurs</a></li>
			  </ul>	
			</div>
		</header>
	  </section>
  
	<div> <!-- colonne avec deux lignes -->
	  <!-- bloc find data -->
	  <div class="span4">
		  <div class="module-shallow module-narrow blue-hand">
			  <!-- <h3 class="heading">Find data</h3> -->
			  <ul class="unstyled circle-padding">
			  	<li>Naviguer <a href="${c.site_url}${h.url_for('/tag')}?themes=true">Par thèmes</a></li>
			  	<li class="blue-hand-line-margin">Naviguer <a href="${c.site_url}${h.url_for('/tag')}">Par tags</a></li>
			  	<li>Il y  a actuellement <a href="${h.url_for(controller='package', action='search')}">${c.package_count}  datasets</a></li>
			  	<li class="blue-hand-line-margin">Télécharger le catalogue : 
			  		<a href="${c.site_url}/dump/Datalocale.rdf"> RDF</a> -
			  		<a href="${c.site_url}/dump/Datalocale.json"> JSON</a> -
			  		<a href="${c.site_url}/dump/Datalocale.csv"> CSV</a> 
			  	</li>
			  </ul>
			  <h3 class="media-heading" id="blue-hand-title">Données</h3>	
			</div>
	  </div>
	  <div class="row">
	  	<div class="span8">
	  		<ul class="unstyled dataset-list">
	  			<py:for each="facet in enumerate(c.groups[:3])">
	  			<li class="dataset-item module-content" if="facet and facet[1] and facet[1] != ''">
	  				<div class="dataset-content">
	  					<h3 class="dataset-heading">
	  						<a href="${h.url_for('/diffuseur')}/${facet[1].get('name')}">${facet[1].get('display_name')}</a>
	  					</h3>
	  					<div>${facet[1].get('description')[:200]}...</div>
	  					${facet[1].get('title')} has ${facet[1].get('packages')} datasets.
	  				</div>
	  			</li>
	  		</py:for>
	  	</ul>

	  	<section>
	  		<header>
	  			<div class="media-content">
	  				<h4>Datasets</h4>
	  			</div>
	  		</header>
	  		<ul class="unstyled dataset-list">
	  			<py:for each="dataset in c.datasets">
	  			<li class="dataset-item module-content" if="dataset and dataset != ''">
	  				<div class="dataset-content">
	  					<h3 class="dataset-heading">
	  						<a href="/dataset/${dataset['name']}">${dataset.get('title','')}</a>
	  					</h3> 
	  					<py:if test="dataset.get('notes','')">
	  					<div>
	  						${dataset.get('notes','')[:200]}
	  					</div>
	  				</py:if>
	  				</div>
	  			</li>
	  			</py:for>
	  		</ul>
			</section>
			</div>
		<div class="span4">
			<form class="dataset-search" method="get" action="/dataset">
				<span class="control-group search-giant">
					<input type="text" class="search" name="q" value="" autocomplete="off" placeholder="${_('Find datasets')}" />
					<button type="submit" value="Search">Submit</button>
				</span>
			</form>
		  <div class="tags">
			<h3 class="tag">Popular</h3>
				<ul class="tag-list">
				<?python
				exclude_list = ['à enrichir','exhaustive', 'à améliorer', 'référence', 'échantillon']
				count = 0
				?>
				<py:if test="c.search_facets and c.search_facets != '' and c.search_facets.get('tags') and c.search_facets.get('tags') != '' ">
				<py:for each="facet in enumerate(c.search_facets.get('tags')['items'])">
					<li py:if="facet[1] and facet[1] != '' and facet[1].get('name','') not in exclude_list and count in [0,1,2]">
					  <a class="tag" href="/dataset?tags=${facet[1].get('name','')}" style="text-transform:lowercase; text-transform:capitalize">${facet[1].get('display_name','')}</a>
					<?python
						count  += 1
					?>
					</li>
				</py:for>
				</py:if>
				</ul>
		  </div>
		</div>
		</div>

	</div> <!-- fin de colone--> 
	</div> <!-- fin de ligne bootstrap-->

  </div>
  </div>
  </div>
  <xi:include href="layout.html" />
</html>

